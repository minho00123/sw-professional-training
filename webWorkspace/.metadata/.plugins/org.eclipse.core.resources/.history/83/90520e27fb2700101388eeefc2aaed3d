<%@ page contentType="text/html; charset=UTF-8" language="java"%>
<%@ page import="java.util.List"%>
<%@ page import="com.mvc.model.BoardDto"%>
<%@ page import="com.mvc.model.BoardDao"%>
<!DOCTYPE html>
<html>
<head>
    <title>📋 JSP 게시판</title>
    <style>
        body { background-color: #f7f9fc; }
        .container { width: 80%; max-width: 900px; margin: 40px auto; background-color: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-radius: 10px; padding: 30px; }
        h2 { text-align: center; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 14px 10px; text-align: center; }
        th { background-color: #4a90e2; color: white; }
        tr:nth-child(even) { background-color: #f1f5fa; }
        tr:hover { background-color: #e1ecf7; transition: 0.3s; }
        .write-btn { margin-top: 20px; text-align: right; }
        .write-btn a { background-color: #4a90e2; color: white; padding: 10px 18px; border-radius: 6px; text-decoration: none; }
        .pagination { text-align: center; margin-top: 30px; }
        .pagination a { margin: 0 5px; padding: 8px 12px; text-decoration: none; background-color: #eee; color: #333; border-radius: 4px; }
        .pagination a.active { background-color: #4a90e2; color: white; }
        .search-box { display: flex; justify-content: space-between; margin-top: 20px; }
        .search-box input[type="text"] { padding: 8px; width: 200px; border-radius: 4px; border: 1px solid #ccc; }
        .search-box input[type="submit"] { padding: 8px 12px; background-color: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h2>📋 JSP 게시판</h2>

        <div class="search-box">
            <!-- 검색 폼 -->
            <form method="get" action="<%=request.getContextPath()%>/list">
                <input type="text" name="keyword"
                       value="<%=request.getAttribute("keyword") != null ? request.getAttribute("keyword") : ""%>"
                       placeholder="검색어 입력">
                <input type="submit" value="검색">
            </form>
            <div class="write-btn">
                <a href="write.jsp">✏️ 글쓰기</a>
            </div>
        </div>

        <table>
            <tr>
                <th>번호</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
            </tr>
            <%
                List<BoardDto> boardList = (List<BoardDto>) request.getAttribute("dataList");
                int currentPage = (Integer) request.getAttribute("currentPage");
                int totalPages = (Integer) request.getAttribute("totalPages");
            %>
            <% for (BoardDto board : boardList) { %>
            <tr>
                <td><%= board.getId() %></td>
                <td style="text-align: left;">
                    <a href="detail.jsp?id=<%= board.getId() %>"><%= board.getTitle() %></a>
                </td>
                <td><%= board.getUserId() %></td>
                <td><%= board.getCreatedAt() %></td>
            </tr>

            <%-- 댓글 및 대댓글 출력 --%>
            <tr>
                <td colspan="4" style="padding-left: 30px;">
                    <% if (board.getReplies() != null) { %>
                    <ul>
                        <% for (BoardDto reply : board.getReplies()) { %>
                        <li><%= reply.getUserId() %>: <%= reply.getContent() %> (<%= reply.getCreatedAt() %>)</li>
                        <% } %>
                    </ul>
                    <% } %>
                </td>
            </tr>
            <% } %>
        </table>

        <div class="pagination">
            <%
                int prevPage = currentPage - 1 > 0 ? currentPage - 1 : 1;
                int nextPage = currentPage + 1 <= totalPages ? currentPage + 1 : totalPages;

                int pageGroupSize = 10;
                int startPage = ((currentPage - 1) / pageGroupSize) * pageGroupSize + 1;
                int endPage = Math.min(startPage + pageGroupSize - 1, totalPages);
            %>

            <% if (startPage > 1) { %>
                <a href="?page=<%= prevPage %>&keyword=<%= request.getParameter("keyword") %>">&lt;</a>
            <% } %>

            <% for (int i = startPage; i <= endPage; i++) { %>
                <a href="?page=<%= i %>&keyword=<%= request.getParameter("keyword") %>"
                   class="<%= i == currentPage ? "active" : "" %>"><%= i %></a>
            <% } %>

            <% if (endPage < totalPages) { %>
                <a href="?page=<%= nextPage %>&keyword=<%= request.getParameter("keyword") %>">&gt;</a>
            <% } %>
        </div>
    </div>
</body>
</html>
